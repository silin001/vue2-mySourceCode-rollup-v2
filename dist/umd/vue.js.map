{"version":3,"file":"vue.js","sources":["../../src/utils/index.js","../../src/observe/array.js","../../src/observe/index.js","../../src/initState.js","../../src/init.js","../../src/index.js"],"sourcesContent":["// å·¥å…·ç±»æ–¹æ³•\r\n// å½“å‰æ•°æ®æ˜¯ä¸æ˜¯å¯¹è±¡ \r\nexport function isObject (data) {\r\n  return typeof data === 'object' && data !== null\r\n}\r\n\r\nexport function def (data, key, value) {\r\n  Object.defineProperty(data, key, {\r\n    enumerable: false, // ä¸å¯æšä¸¾=>å¾ªç¯\r\n    configurable: false,// ä¸å¯ä¿®æ”¹\r\n    value\r\n  })\r\n}","// é‡å†™æ•°ç»„é‚£äº›æ–¹æ³•ï¼Œ 7ä¸ª push shift unshift pop reverse sort splice ä¼šå¯¼è‡´æ•°ç»„æœ¬èº«å‘ç”Ÿå˜åŒ–\r\n\r\nlet oldArrayMethods = Array.prototype // ä¿å­˜åŸç†æ•°ç»„çš„æ–¹æ³•\r\n// ç”¨æˆ·ä½¿ç”¨æ—¶ï¼š value.__proto__ = arraryMethods   psï¼šåŸå‹é“¾æŸ¥æ‰¾æ¦‚å¿µï¼Œä¼šå‘ä¸ŠæŸ¥æ‰¾ å…ˆæŸ¥æ‰¾æˆ‘é‡å†™çš„ï¼Œé‡å†™çš„æ²¡æœ‰ ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾\r\n//arrayMethods.__proto__ = oldArrayMethods\r\nexport const arrayMethods = Object.create(oldArrayMethods)\r\nconst methods = [\r\n  'push',\r\n  'shift',\r\n  'unshift',\r\n  'pop',\r\n  'reverse',\r\n  'sort',\r\n  'splice'\r\n]\r\n// å¾ªç¯é‡å†™7ç§æ•°ç»„æ–¹æ³•\r\nmethods.forEach((method) => {\r\n  arrayMethods[method] = function (...args) {\r\n    console.log('ç”¨æˆ·è°ƒç”¨äº†push å‚æ•°ä¸º:', args) // AOPåˆ‡ç‰‡è¿‡ç¨‹\r\n    const result = oldArrayMethods[method].apply(this, args) // ç”¨æˆ·è°ƒç”¨æˆ‘ä»¬æ–¹æ³•-> æˆ‘ä»¬åœ¨è°ƒç”¨åŸç”Ÿæ–¹æ³•ï¼Œ æ‹¿åˆ°è¿”å›å€¼\r\n    console.log('ğŸš€ğŸš€ ~ file: array.js ~ line 20 ~ methods.forEach ~ result', result)\r\n    // ç”¨æˆ·ä½¿ç”¨ push unshift æ“ä½œæ—¶ å€¼å¯èƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ å¯¹è±¡æ•°æ®æˆ‘ä»¬éœ€è¦ç»§ç»­æ£€æµ‹! â­\r\n    let inserted // å½“å‰ç”¨æˆ·æ’å…¥çš„å…ƒç´ \r\n    const ob = this.__ob__  // æ‹¿åˆ°Observer ç±» ç›‘æ§è¿‡çš„å¯¹è±¡æ·»åŠ çš„__ob__ å±æ€§ é‡Œé¢æœ‰observerArrayç­‰æ–¹æ³•\r\n    // console.log('ğŸš€ğŸš€ ~ file: array.js ~ line 23 ~ methods.forEach ~ ob', ob)\r\n    switch (method) {\r\n      case 'push':\r\n        inserted = args\r\n        break;\r\n      case 'unshift':\r\n        inserted = args\r\n        break;\r\n      case 'splice':  // æ–°å¢çš„å±æ€§spliceæœ‰åˆ é™¤ï¼Œæ–°å¢åŠŸèƒ½ï¼Œ arr.splice(0,1,{name:1})\r\n        inserted = args.splice(2)\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    console.log(inserted)\r\n    if (inserted) ob.observerArray(inserted) // â­ è°ƒç”¨ observerArray å¯¹æ–°å¢çš„æ•°æ®ç»§ç»­ è¿›è¡Œç›‘æµ‹\r\n    return result\r\n  }\r\n})\r\n","// å¯¹è±¡çš„æ•°æ®åŠ«æŒï¼\r\n// æŠŠdataä¸­çš„å¯¹è±¡æ•°æ®ä½¿ç”¨Object.defineProperty é‡æ–°å®šä¹‰ï¼Œ es5æ–¹æ³•\r\n// è¯¥æ–¹æ³•ä¸å…¼å®¹ie8 åŠä»¥ä¸‹ï¼Œ vue2 æ— æ³•å…¼å®¹ie8\r\nimport { isObject, def } from '../utils/index'\r\nimport { arrayMethods } from './array'\r\n// â­å®šä¹‰å“åº”å¼æ•°æ®\r\nfunction defineReactive (data, key, value) {\r\n  observe(value) //â­ é€’å½’å®ç°æ·±åº¦ç›‘æµ‹ï¼Œå±‚æ¬¡è¶Šæ·±è¶Šå·®\r\n  Object.defineProperty(data, key, {\r\n    get () {\r\n      return value\r\n    },\r\n    set (newVal) {\r\n      if (newVal === value) return\r\n      console.log('å€¼æ”¹å˜äº†')\r\n      observe(newVal)       // â­ç»§ç»­åŠ«æŒç”¨æˆ·è®¾ç½®çš„å€¼ï¼Œå› ä¸ºæœ‰å¯ä»¥ç”¨æˆ·è®¾ç½®çš„å€¼ä¸º{}\r\n      value = newVal\r\n    }\r\n  })\r\n}\r\n// è§‚å¯Ÿæ•°æ® ç±»\r\nclass Observer {\r\n  constructor(value) {\r\n    // vueå¦‚æœæ•°æ®çš„å±‚æ¬¡è¿‡å¤š éœ€è¦é€’å½’å»è§£æå¯¹è±¡ä¸­çš„å±æ€§,ä¾æ¬¡æ·»åŠ get, setæ–¹æ³•\r\n    // BUG è¿™æ ·å†™ä¼šæ­»å¾ªç¯\r\n    // value.__ob__ = this // â­ è¿™é‡Œç»™æ¯ä¸€ä¸ªç›‘æ§è¿‡çš„å¯¹è±¡æ–°å¢ä¸€ä¸ª__ob__ å±æ€§ï¼Œåœ¨æ•°ç»„æ–¹æ³•é‡å†™æ—¶éœ€è¦ç”¨åˆ°\r\n    // ä½¿ç”¨Object.defineProperty æ–¹æ³•å»æ·»åŠ \r\n    def(value, '__ob__', this)\r\n    if (Array.isArray(value)) {\r\n      // å¦‚æœæ˜¯æ•°ç»„çš„è¯å¹¶ä¸ä¼šå¯¹ç´¢å¼•è¿›è¡Œè§‚æµ‹ï¼Œå› ä¸ºä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜\r\n      // å‰ç«¯å¼€å‘ä¸­å¾ˆå°‘æ“ä½œç´¢å¼•ï¼Œ  push unshift unshift\r\n      // å¦‚æœæ•°ç»„é‡Œæ”¾çš„æ˜¯å¯¹è±¡æˆ‘åœ¨ç›‘æ§\r\n      // console.log(arrayMethods)\r\n      // 2.â­ ç”¨æˆ·å¯èƒ½ä½¿ç”¨ this.data.arr.push({}) ..ç­‰æ–¹æ³• æ‰€æœ‰è¦é‡å†™è¿™äº›æ–¹æ³•\r\n      value.__proto__ = arrayMethods // åŸå‹æ·»åŠ æˆ‘ä»¬é‡å†™çš„æ•°ç»„æ–¹æ³•\r\n      this.observerArray(value) // 1.æ•°ç»„ä¸­æ¯ä¸€é¡¹è¿›è¡Œè§‚æµ‹\r\n    } else {\r\n      this.walk(value) // å¯¹è±¡çš„è¿›è¡Œè§‚æµ‹\r\n\r\n    }\r\n  }\r\n  observerArray (data) {\r\n    for (let index = 0; index < data.length; index++) {\r\n      observe(data[index])\r\n    }\r\n  }\r\n  walk (data) {\r\n    let keys = Object.keys(data) //è·å–data keyå€¼ [name,age,address]\r\n    keys.forEach((key) => {\r\n      defineReactive(data, key, data[key]) // å®šä¹‰å“åº”å¼æ•°æ®\r\n    })\r\n    // for (let index = 0; index < keys.length; index++) {\r\n    //   const key = keys[index]\r\n    //   const value = data[key]\r\n    // defineReactive(data, key, value]) // å®šä¹‰å“åº”å¼æ•°æ®\r\n    // }\r\n  }\r\n}\r\n\r\nexport function observe (data) {\r\n  console.log(data, 'observe')\r\n  const isObj = isObject(data)\r\n  if (!isObj) return\r\n  return new Observer(data)  // ç”¨æ¥è§‚æµ‹æ•°æ®\r\n}","import { observe } from './observe/index'\r\nexport function initState (vm) {\r\n  const opts = vm.$options\r\n  // vue çš„æ•°æ®æ¥æº å±æ€§ æ–¹æ³•  æ•°æ® è®¡ç®—å±æ€§ watch\r\n  // console.log(opts)\r\n  if (opts.props) {\r\n    initProps(vm)\r\n  }\r\n  if (opts.methods) {\r\n    initMethods(vm)\r\n  }\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n  if (opts.computed) {\r\n    initComputed(vm)\r\n  }\r\n  if (opts.watch) {\r\n    initWatch(vm)\r\n  }\r\n\r\n}\r\nfunction initProps (vm) {\r\n  // console.log('åˆå§‹åŒ–æ•°æ®', vm.$options.data)\r\n}\r\nfunction initMethods (vm) {\r\n  // console.log('åˆå§‹åŒ–æ•°æ®', vm.$options.data)\r\n}\r\nfunction initComputed (vm) {\r\n  // console.log('åˆå§‹åŒ–æ•°æ®', vm.$options.data)\r\n}\r\nfunction initData (vm) {\r\n  console.log('åˆå§‹åŒ–æ•°æ®', vm.$options.data)\r\n  // æ•°æ®åˆå§‹åŒ–å·¥ä½œ\r\n  let data = vm.$options.data\r\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data\r\n  // å¯¹è±¡åŠ«æŒï¼Œç”¨æˆ·æ”¹å˜æ•°æ® æˆ‘å¸Œæœ›å¯ä»¥å¾—åˆ°é€šçŸ¥-åˆ·æ–°é¡µé¢\r\n  // mvvm æ¨¡å¼ æ•°æ®å˜åŒ–å¯ä»¥æ›´æ–°è§†å›¾\r\n  observe(data) // å“åº”å¼åŸç†\r\n}\r\n\r\nfunction initWatch (vm) {\r\n  console.log('åˆå§‹åŒ–æ•°æ®', vm.$options.data)\r\n}","import { initState } from './initState'\r\n// åœ¨åŸå‹ä¸Šæ·»åŠ ä¸€ä¸ªinitæ–¹æ³•\r\nexport function initMixin (Vue) {\r\n  // åˆå§‹åŒ–æµç¨‹\r\n  Vue.prototype._init = function (options) {\r\n    console.log(options)\r\n    // 1.åŠ«æŒæ•°æ®\r\n    const vm = this\r\n    console.log(vm)\r\n    vm.$options = options\r\n    // åˆå§‹åŒ–çŠ¶æ€\r\n    initState(vm)\r\n  }\r\n}","// vueæ ¸å¿ƒ åªæ˜¯vueçš„ä¸€ä¸ªå£°æ˜æ–‡ä»¶\r\nimport { initMixin } from './init'\r\n\r\n\r\nfunction Vue (options) {\r\n  //vue åˆå§‹åŒ–æ“ä½œ\r\n  this._init(options)\r\n}\r\n// é€šè¿‡å¼•å…¥æ–‡ä»¶æ–¹å¼ç»™vueåŸå‹æ·»åŠ æ–¹æ³•\r\ninitMixin(Vue) // ç»™vueåŸå‹æ·»åŠ _initæ–¹æ³•\r\nexport default Vue"],"names":[],"mappings":"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"}